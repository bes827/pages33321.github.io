<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>QA</title>
<script src="data:application/javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gdHJ5RXZhbCh0YXNrKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgLy8gQXR0ZW1wdCBldmFsKCkgYm90aCB3aXRoIGFuZCB3aXRob3V0IGVuY2xvc2luZyBpbiBwYXJlbnRoZXNlcy4KICAvLyBOb3RlIHRoYXQgZW5jbG9zaW5nIGNvZXJjZXMgYSBmdW5jdGlvbiBkZWNsYXJhdGlvbiBpbnRvCiAgLy8gYW4gZXhwcmVzc2lvbiB0aGF0IGV2YWwoKSBjYW4gcGFyc2UKICAvLyAob3RoZXJ3aXNlLCBhIFN5bnRheEVycm9yIGlzIHRocm93bikKICBmdW5jdGlvbiB0cnlFdmFsKGNvZGUpIHsKICAgIHZhciByZXN1bHQgPSBudWxsOwogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gZXZhbCgiKCIgKyBjb2RlICsgIikiKTsKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgaWYgKCFlcnJvciBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICByZXN1bHQgPSBldmFsKGNvZGUpOwogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBpbml0U2l6aW5nKGVsKSB7CiAgICB2YXIgc2l6aW5nID0gc2l6aW5nUG9saWN5KGVsKTsKICAgIGlmICghc2l6aW5nKQogICAgICByZXR1cm47CgogICAgdmFyIGNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJodG1sd2lkZ2V0X2NvbnRhaW5lciIpOwogICAgaWYgKCFjZWwpCiAgICAgIHJldHVybjsKCiAgICBpZiAodHlwZW9mKHNpemluZy5wYWRkaW5nKSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSAiMCI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZyA9IHBhZGRpbmdUb0Nzcyh1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKSk7CiAgICB9CgogICAgaWYgKHNpemluZy5maWxsKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICIxMDAlIjsKICAgICAgaWYgKGNlbCkgewogICAgICAgIGNlbC5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICAgICAgdmFyIHBhZCA9IHVucGFja1BhZGRpbmcoc2l6aW5nLnBhZGRpbmcpOwogICAgICAgIGNlbC5zdHlsZS50b3AgPSBwYWQudG9wICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUucmlnaHQgPSBwYWQucmlnaHQgKyAicHgiOwogICAgICAgIGNlbC5zdHlsZS5ib3R0b20gPSBwYWQuYm90dG9tICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUubGVmdCA9IHBhZC5sZWZ0ICsgInB4IjsKICAgICAgICBlbC5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0V2lkdGg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBjZWwub2Zmc2V0SGVpZ2h0OyB9CiAgICAgIH07CgogICAgfSBlbHNlIHsKICAgICAgZWwuc3R5bGUud2lkdGggPSBweChzaXppbmcud2lkdGgpOwogICAgICBlbC5zdHlsZS5oZWlnaHQgPSBweChzaXppbmcuaGVpZ2h0KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0V2lkdGg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZWwub2Zmc2V0V2lkdGg7IH0sCiAgICAgICAgZ2V0SGVpZ2h0OiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwogICAgfQogIH0KCiAgLy8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbnMgZm9yIG1ldGhvZHMKICB2YXIgZGVmYXVsdHMgPSB7CiAgICBmaW5kOiBmdW5jdGlvbihzY29wZSkgewogICAgICByZXR1cm4gcXVlcnlTZWxlY3RvckFsbChzY29wZSwgIi4iICsgdGhpcy5uYW1lKTsKICAgIH0sCiAgICByZW5kZXJFcnJvcjogZnVuY3Rpb24oZWwsIGVycikgewogICAgICB2YXIgJGVsID0gJChlbCk7CgogICAgICB0aGlzLmNsZWFyRXJyb3IoZWwpOwoKICAgICAgLy8gQWRkIGFsbCB0aGVzZSBlcnJvciBjbGFzc2VzLCBhcyBTaGlueSBkb2VzCiAgICAgIHZhciBlcnJDbGFzcyA9ICJzaGlueS1vdXRwdXQtZXJyb3IiOwogICAgICBpZiAoZXJyLnR5cGUgIT09IG51bGwpIHsKICAgICAgICAvLyB1c2UgdGhlIGNsYXNzZXMgb2YgdGhlIGVycm9yIGNvbmRpdGlvbiBhcyBDU1MgY2xhc3MgbmFtZXMKICAgICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiAiICsgJC5tYXAoYXNBcnJheShlcnIudHlwZSksIGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgIHJldHVybiBlcnJDbGFzcyArICItIiArIHR5cGU7CiAgICAgICAgfSkuam9pbigiICIpOwogICAgICB9CiAgICAgIGVyckNsYXNzID0gZXJyQ2xhc3MgKyAiIGh0bWx3aWRnZXRzLWVycm9yIjsKCiAgICAgIC8vIElzIGVsIGlubGluZSBvciBibG9jaz8gSWYgaW5saW5lIG9yIGlubGluZS1ibG9jaywganVzdCBkaXNwbGF5Om5vbmUgaXQKICAgICAgLy8gYW5kIGFkZCBhbiBpbmxpbmUgZXJyb3IuCiAgICAgIHZhciBkaXNwbGF5ID0gJGVsLmNzcygiZGlzcGxheSIpOwogICAgICAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiLCBkaXNwbGF5KTsKCiAgICAgIGlmIChkaXNwbGF5ID09PSAiaW5saW5lIiB8fCBkaXNwbGF5ID09PSAiaW5saW5lLWJsb2NrIikgewogICAgICAgICRlbC5oaWRlKCk7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yU3BhbiA9ICQoIjxzcGFuPiIpLmFkZENsYXNzKGVyckNsYXNzKTsKICAgICAgICAgIGVycm9yU3Bhbi50ZXh0KGVyci5tZXNzYWdlKTsKICAgICAgICAgICRlbC5hZnRlcihlcnJvclNwYW4pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkaXNwbGF5ID09PSAiYmxvY2siKSB7CiAgICAgICAgLy8gSWYgYmxvY2ssIGFkZCBhbiBlcnJvciBqdXN0IGFmdGVyIHRoZSBlbCwgc2V0IHZpc2liaWxpdHk6bm9uZSBvbiB0aGUKICAgICAgICAvLyBlbCwgYW5kIHBvc2l0aW9uIHRoZSBlcnJvciB0byBiZSBvbiB0b3Agb2YgdGhlIGVsLgogICAgICAgIC8vIE1hcmsgaXQgd2l0aCBhIHVuaXF1ZSBJRCBhbmQgQ1NTIGNsYXNzIHNvIHdlIGNhbiByZW1vdmUgaXQgbGF0ZXIuCiAgICAgICAgJGVsLmNzcygidmlzaWJpbGl0eSIsICJoaWRkZW4iKTsKICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgIT09ICIiKSB7CiAgICAgICAgICB2YXIgZXJyb3JEaXYgPSAkKCI8ZGl2PiIpLmFkZENsYXNzKGVyckNsYXNzKS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIikKICAgICAgICAgICAgLmNzcygidG9wIiwgZWwub2Zmc2V0VG9wKQogICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgLy8gc2V0dGluZyB3aWR0aCBjYW4gcHVzaCBvdXQgdGhlIHBhZ2Ugc2l6ZSwgZm9yY2luZyBvdGhlcndpc2UKICAgICAgICAgICAgLy8gdW5uZWNlc3Nhcnkgc2Nyb2xsYmFycyB0byBhcHBlYXIgYW5kIG1ha2luZyBpdCBpbXBvc3NpYmxlIGZvcgogICAgICAgICAgICAvLyB0aGUgZWxlbWVudCB0byBzaHJpbms7IHNvIHVzZSBtYXgtd2lkdGggaW5zdGVhZAogICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAuY3NzKCJoZWlnaHQiLCBlbC5vZmZzZXRIZWlnaHQpOwogICAgICAgICAgZXJyb3JEaXYudGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JEaXYpOwoKICAgICAgICAgIC8vIFJlYWxseSBkdW1iIHdheSB0byBrZWVwIHRoZSBzaXplL3Bvc2l0aW9uIG9mIHRoZSBlcnJvciBpbiBzeW5jIHdpdGgKICAgICAgICAgIC8vIHRoZSBwYXJlbnQgZWxlbWVudCBhcyB0aGUgd2luZG93IGlzIHJlc2l6ZWQgb3Igd2hhdGV2ZXIuCiAgICAgICAgICB2YXIgaW50SWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCFlcnJvckRpdlswXS5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRJZCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yRGl2CiAgICAgICAgICAgICAgLmNzcygidG9wIiwgZWwub2Zmc2V0VG9wKQogICAgICAgICAgICAgIC5jc3MoImxlZnQiLCBlbC5vZmZzZXRMZWZ0KQogICAgICAgICAgICAgIC5jc3MoIm1heFdpZHRoIiwgZWwub2Zmc2V0V2lkdGgpCiAgICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2xlYXJFcnJvcjogZnVuY3Rpb24oZWwpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwogICAgICB2YXIgZGlzcGxheSA9ICRlbC5kYXRhKCJyZXN0b3JlLWRpc3BsYXktbW9kZSIpOwogICAgICAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiLCBudWxsKTsKCiAgICAgIGlmIChkaXNwbGF5ID09PSAiaW5saW5lIiB8fCBkaXNwbGF5ID09PSAiaW5saW5lLWJsb2NrIikgewogICAgICAgIGlmIChkaXNwbGF5KQogICAgICAgICAgJGVsLmNzcygiZGlzcGxheSIsIGRpc3BsYXkpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIil7CiAgICAgICAgJGVsLmNzcygidmlzaWJpbGl0eSIsICJpbmhlcml0Iik7CiAgICAgICAgJChlbC5uZXh0U2libGluZykuZmlsdGVyKCIuaHRtbHdpZGdldHMtZXJyb3IiKS5yZW1vdmUoKTsKICAgICAgfQogICAgfSwKICAgIHNpemluZzoge30KICB9OwoKICAvLyBDYWxsZWQgYnkgd2lkZ2V0IGJpbmRpbmdzIHRvIHJlZ2lzdGVyIGEgbmV3IHR5cGUgb2Ygd2lkZ2V0LiBUaGUgZGVmaW5pdGlvbgogIC8vIG9iamVjdCBjYW4gY29udGFpbiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgLy8gLSBuYW1lIChyZXF1aXJlZCkgLSBBIHN0cmluZyBpbmRpY2F0aW5nIHRoZSBiaW5kaW5nIG5hbWUsIHdoaWNoIHdpbGwgYmUKICAvLyAgIHVzZWQgYnkgZGVmYXVsdCBhcyB0aGUgQ1NTIGNsYXNzbmFtZSB0byBsb29rIGZvci4KICAvLyAtIGluaXRpYWxpemUgKG9wdGlvbmFsKSAtIEEgZnVuY3Rpb24oZWwpIHRoYXQgd2lsbCBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIHdpZGdldCBlbGVtZW50OyBpZiBhIHZhbHVlIGlzIHJldHVybmVkLCBpdCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgdGhpcmQKICAvLyAgIHZhbHVlIHRvIHJlbmRlclZhbHVlLgogIC8vIC0gcmVuZGVyVmFsdWUgKHJlcXVpcmVkKSAtIEEgZnVuY3Rpb24oZWwsIGRhdGEsIGluaXRWYWx1ZSkgdGhhdCB3aWxsIGJlCiAgLy8gICBjYWxsZWQgd2l0aCBkYXRhLiBTdGF0aWMgY29udGV4dHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBvbmNlIHBlcgogIC8vICAgZWxlbWVudDsgU2hpbnkgYXBwcyB3aWxsIGNhdXNlIHRoaXMgdG8gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIHBlcgogIC8vICAgZWxlbWVudCwgYXMgdGhlIGRhdGEgY2hhbmdlcy4KICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0ID0gZnVuY3Rpb24oZGVmaW5pdGlvbikgewogICAgaWYgKCFkZWZpbml0aW9uLm5hbWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgbmFtZSIpOwogICAgfQogICAgaWYgKCFkZWZpbml0aW9uLnR5cGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgdHlwZSIpOwogICAgfQogICAgLy8gQ3VycmVudGx5IHdlIG9ubHkgc3VwcG9ydCBvdXRwdXQgd2lkZ2V0cwogICAgaWYgKGRlZmluaXRpb24udHlwZSAhPT0gIm91dHB1dCIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnJlY29nbml6ZWQgd2lkZ2V0IHR5cGUgJyIgKyBkZWZpbml0aW9uLnR5cGUgKyAiJyIpOwogICAgfQogICAgLy8gVE9ETzogVmVyaWZ5IHRoYXQgLm5hbWUgaXMgYSB2YWxpZCBDU1MgY2xhc3NuYW1lCgogICAgLy8gU3VwcG9ydCBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMuIE9sZC1zdHlsZSBjbGFzcy1ib3VuZAogICAgLy8gZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0ICJvYmplY3QiIHBlciB3aWRnZXQgcGVyIHR5cGUvY2xhc3Mgb2YKICAgIC8vIHdpZGdldDsgdGhlIHJlbmRlclZhbHVlIGFuZCByZXNpemUgbWV0aG9kcyBvbiBzdWNoIHdpZGdldCBvYmplY3RzCiAgICAvLyB0YWtlIGVsIGFuZCBpbnN0YW5jZSBhcmd1bWVudHMsIGJlY2F1c2UgdGhlIHdpZGdldCBvYmplY3QgY2FuJ3QKICAgIC8vIHN0b3JlIHRoZW0uIE5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9ucyBoYXZlIG9uZSB3aWRnZXQKICAgIC8vIG9iamVjdCBwZXIgd2lkZ2V0IGluc3RhbmNlOyB0aGUgZGVmaW5pdGlvbiB0aGF0J3MgcGFzc2VkIGluIGRvZXNuJ3QKICAgIC8vIHByb3ZpZGUgcmVuZGVyVmFsdWUgb3IgcmVzaXplIG1ldGhvZHMgYXQgYWxsLCBqdXN0IHRoZSBzaW5nbGUgbWV0aG9kCiAgICAvLyAgIGZhY3RvcnkoZWwsIHdpZHRoLCBoZWlnaHQpCiAgICAvLyB3aGljaCByZXR1cm5zIGFuIG9iamVjdCB0aGF0IGhhcyByZW5kZXJWYWx1ZSh4KSBhbmQgcmVzaXplKHcsIGgpLgogICAgLy8gVGhpcyBlbmFibGVzIGEgZmFyIG1vcmUgbmF0dXJhbCBwcm9ncmFtbWluZyBzdHlsZSBmb3IgdGhlIHdpZGdldAogICAgLy8gYXV0aG9yLCB3aG8gY2FuIHN0b3JlIHBlci1pbnN0YW5jZSBzdGF0ZSB1c2luZyBlaXRoZXIgT08tc3R5bGUKICAgIC8vIGluc3RhbmNlIGZpZWxkcyBvciBmdW5jdGlvbmFsLXN0eWxlIGNsb3N1cmUgdmFyaWFibGVzIChJIGd1ZXNzIHRoaXMKICAgIC8vIGlzIGluIGNvbnRyYXN0IHRvIHdoYXQgY2FuIG9ubHkgYmUgY2FsbGVkIEMtc3R5bGUgcHNldWRvLU9PIHdoaWNoIGlzCiAgICAvLyB3aGF0IHdlIHJlcXVpcmVkIGJlZm9yZSkuCiAgICBpZiAoZGVmaW5pdGlvbi5mYWN0b3J5KSB7CiAgICAgIGRlZmluaXRpb24gPSBjcmVhdGVMZWdhY3lEZWZpbml0aW9uQWRhcHRlcihkZWZpbml0aW9uKTsKICAgIH0KCiAgICBpZiAoIWRlZmluaXRpb24ucmVuZGVyVmFsdWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgcmVuZGVyVmFsdWUgZnVuY3Rpb24iKTsKICAgIH0KCiAgICAvLyBGb3Igc3RhdGljIHJlbmRlcmluZyAobm9uLVNoaW55KSwgdXNlIGEgc2ltcGxlIHdpZGdldCByZWdpc3RyYXRpb24KICAgIC8vIHNjaGVtZS4gV2UgYWxzbyB1c2UgdGhpcyBzY2hlbWUgZm9yIFNoaW55IGFwcHMvZG9jdW1lbnRzIHRoYXQgYWxzbwogICAgLy8gY29udGFpbiBzdGF0aWMgd2lkZ2V0cy4KICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICAvLyBNZXJnZSBkZWZhdWx0cyBpbnRvIHRoZSBkZWZpbml0aW9uOyBkb24ndCBtdXRhdGUgdGhlIG9yaWdpbmFsIGRlZmluaXRpb24uCiAgICB2YXIgc3RhdGljQmluZGluZyA9IGV4dGVuZCh7fSwgZGVmYXVsdHMsIGRlZmluaXRpb24pOwogICAgb3ZlcnJpZGVNZXRob2Qoc3RhdGljQmluZGluZywgImZpbmQiLCBmdW5jdGlvbihzdXBlcmZ1bmMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSBzdXBlcmZ1bmMoc2NvcGUpOwogICAgICAgIC8vIEZpbHRlciBvdXQgU2hpbnkgb3V0cHV0cywgd2Ugb25seSB3YW50IHRoZSBzdGF0aWMga2luZAogICAgICAgIHJldHVybiBmaWx0ZXJCeUNsYXNzKHJlc3VsdHMsICJodG1sLXdpZGdldC1vdXRwdXQiLCBmYWxzZSk7CiAgICAgIH07CiAgICB9KTsKICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzLnB1c2goc3RhdGljQmluZGluZyk7CgogICAgaWYgKHNoaW55TW9kZSkgewogICAgICAvLyBTaGlueSBpcyBydW5uaW5nLiBSZWdpc3RlciB0aGUgZGVmaW5pdGlvbiB3aXRoIGFuIG91dHB1dCBiaW5kaW5nLgogICAgICAvLyBUaGUgZGVmaW5pdGlvbiBpdHNlbGYgd2lsbCBub3QgYmUgdGhlIG91dHB1dCBiaW5kaW5nLCBpbnN0ZWFkCiAgICAgIC8vIHdlIHdpbGwgbWFrZSBhbiBvdXRwdXQgYmluZGluZyBvYmplY3QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgIC8vIGRlZmluaXRpb24uIFRoaXMgaXMgYmVjYXVzZSB3ZSBmb29saXNobHkgdXNlZCB0aGUgc2FtZSBtZXRob2QKICAgICAgLy8gbmFtZSAocmVuZGVyVmFsdWUpIGZvciBodG1sd2lkZ2V0cyBkZWZpbml0aW9uIGFuZCBTaGlueSBiaW5kaW5ncwogICAgICAvLyBidXQgdGhleSBhY3R1YWxseSBoYXZlIHF1aXRlIGRpZmZlcmVudCBzZW1hbnRpY3MgKHRoZSBTaGlueQogICAgICAvLyBiaW5kaW5ncyByZWNlaXZlIGRhdGEgdGhhdCBpbmNsdWRlcyBsb3RzIG9mIG1ldGFkYXRhIHRoYXQgaXQKICAgICAgLy8gc3RyaXBzIG9mZiBiZWZvcmUgY2FsbGluZyBodG1sd2lkZ2V0cyByZW5kZXJWYWx1ZSkuIFdlIGNhbid0CiAgICAgIC8vIGp1c3QgaWdub3JlIHRoZSBkaWZmZXJlbmNlIGJlY2F1c2UgaW4gc29tZSB3aWRnZXRzIGl0J3MgaGVscGZ1bAogICAgICAvLyB0byBjYWxsIHRoaXMucmVuZGVyVmFsdWUoKSBmcm9tIGluc2lkZSBvZiByZXNpemUoKSwgYW5kIGlmCiAgICAgIC8vIHdlJ3JlIG5vdCBkZWxlZ2F0aW5nLCB0aGVuIHRoYXQgY2FsbCB3aWxsIGdvIHRvIHRoZSBTaGlueQogICAgICAvLyB2ZXJzaW9uIGluc3RlYWQgb2YgdGhlIGh0bWx3aWRnZXRzIHZlcnNpb24uCgogICAgICAvLyBNZXJnZSBkZWZhdWx0cyB3aXRoIGRlZmluaXRpb24sIHdpdGhvdXQgbXV0YXRpbmcgZWl0aGVyLgogICAgICB2YXIgYmluZGluZ0RlZiA9IGV4dGVuZCh7fSwgZGVmYXVsdHMsIGRlZmluaXRpb24pOwoKICAgICAgLy8gVGhpcyBvYmplY3Qgd2lsbCBiZSBvdXIgYWN0dWFsIFNoaW55IGJpbmRpbmcuCiAgICAgIHZhciBzaGlueUJpbmRpbmcgPSBuZXcgU2hpbnkuT3V0cHV0QmluZGluZygpOwoKICAgICAgLy8gV2l0aCBhIGZldyBleGNlcHRpb25zLCB3ZSdsbCB3YW50IHRvIHNpbXBseSB1c2UgdGhlIGJpbmRpbmdEZWYncwogICAgICAvLyB2ZXJzaW9uIG9mIG1ldGhvZHMgaWYgdGhleSBhcmUgYXZhaWxhYmxlLCBvdGhlcndpc2UgZmFsbCBiYWNrIHRvCiAgICAgIC8vIFNoaW55J3MgZGVmYXVsdHMuIE5PVEU6IElmIFNoaW55J3Mgb3V0cHV0IGJpbmRpbmdzIGdhaW4gYWRkaXRpb25hbAogICAgICAvLyBtZXRob2RzIGluIHRoZSBmdXR1cmUsIGFuZCB3ZSB3YW50IHRoZW0gdG8gYmUgb3ZlcnJpZGVhYmxlIGJ5CiAgICAgIC8vIEhUTUxXaWRnZXQgYmluZGluZyBkZWZpbml0aW9ucywgdGhlbiB3ZSdsbCBuZWVkIHRvIGFkZCB0aGVtIHRvIHRoaXMKICAgICAgLy8gbGlzdC4KICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAiZ2V0SWQiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUNoYW5nZSIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJvblZhbHVlRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAicmVuZGVyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAiY2xlYXJFcnJvciIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJzaG93UHJvZ3Jlc3MiKTsKCiAgICAgIC8vIFRoZSBmaW5kLCByZW5kZXJWYWx1ZSwgYW5kIHJlc2l6ZSBhcmUgaGFuZGxlZCBkaWZmZXJlbnRseSwgYmVjYXVzZSB3ZQogICAgICAvLyB3YW50IHRvIGFjdHVhbGx5IGRlY29yYXRlIHRoZSBiZWhhdmlvciBvZiB0aGUgYmluZGluZ0RlZiBtZXRob2RzLgoKICAgICAgc2hpbnlCaW5kaW5nLmZpbmQgPSBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gYmluZGluZ0RlZi5maW5kKHNjb3BlKTsKCiAgICAgICAgLy8gT25seSByZXR1cm4gZWxlbWVudHMgdGhhdCBhcmUgU2hpbnkgb3V0cHV0cywgbm90IHN0YXRpYyBvbmVzCiAgICAgICAgdmFyIGR5bmFtaWNSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoIi5odG1sLXdpZGdldC1vdXRwdXQiKTsKCiAgICAgICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHdoYXRldmVyIGNhdXNlZCBTaGlueSB0byB0aGluayB0aGVyZSBtaWdodCBiZQogICAgICAgIC8vIG5ldyBkeW5hbWljIG91dHB1dHMsIGFsc28gY2F1c2VkIHRoZXJlIHRvIGJlIG5ldyBzdGF0aWMgb3V0cHV0cy4KICAgICAgICAvLyBTaW5jZSB0aGVyZSBtaWdodCBiZSBsb3RzIG9mIGRpZmZlcmVudCBodG1sd2lkZ2V0cyBiaW5kaW5ncywgd2UKICAgICAgICAvLyBzY2hlZHVsZSBleGVjdXRpb24gZm9yIGxhdGVyLS1ubyBuZWVkIHRvIHN0YXRpY1JlbmRlciBtdWx0aXBsZQogICAgICAgIC8vIHRpbWVzLgogICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCAhPT0gZHluYW1pY1Jlc3VsdHMubGVuZ3RoKQogICAgICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXIoKTsKCiAgICAgICAgcmV0dXJuIGR5bmFtaWNSZXN1bHRzOwogICAgICB9OwoKICAgICAgLy8gV3JhcCByZW5kZXJWYWx1ZSB0byBoYW5kbGUgaW5pdGlhbGl6YXRpb24sIHdoaWNoIHVuZm9ydHVuYXRlbHkgaXNuJ3QKICAgICAgLy8gc3VwcG9ydGVkIG5hdGl2ZWx5IGJ5IFNoaW55IGF0IHRoZSB0aW1lIG9mIHRoaXMgd3JpdGluZy4KCiAgICAgIHNoaW55QmluZGluZy5yZW5kZXJWYWx1ZSA9IGZ1bmN0aW9uKGVsLCBkYXRhKSB7CiAgICAgICAgU2hpbnkucmVuZGVyRGVwZW5kZW5jaWVzKGRhdGEuZGVwcyk7CiAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBkYXRhLmV2YWxzICYmIGkgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2ldKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFiaW5kaW5nRGVmLnJlbmRlck9uTnVsbFZhbHVlKSB7CiAgICAgICAgICBpZiAoZGF0YS54ID09PSBudWxsKSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJpbmhlcml0IjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgIGluaXRTaXppbmcoZWwpOwoKICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiLCB0cnVlKTsKICAgICAgICAgIGlmIChiaW5kaW5nRGVmLmluaXRpYWxpemUpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGJpbmRpbmdEZWYuaW5pdGlhbGl6ZShlbCwgZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIHJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJpbmRpbmdEZWYucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSwgW2VsLCBkYXRhLnhdKTsKICAgICAgfTsKCiAgICAgIC8vIE9ubHkgb3ZlcnJpZGUgcmVzaXplIGlmIGJpbmRpbmdEZWYgaW1wbGVtZW50cyBpdAogICAgICBpZiAoYmluZGluZ0RlZi5yZXNpemUpIHsKICAgICAgICBzaGlueUJpbmRpbmcucmVzaXplID0gZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIC8vIFNoaW55IGNhbiBjYWxsIHJlc2l6ZSBiZWZvcmUgaW5pdGlhbGl6ZS9yZW5kZXJWYWx1ZSBoYXZlIGJlZW4KICAgICAgICAgIC8vIGNhbGxlZCwgd2hpY2ggZG9lc24ndCBtYWtlIHNlbnNlIGZvciB3aWRnZXRzLgogICAgICAgICAgaWYgKGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgICBiaW5kaW5nRGVmLnJlc2l6ZShlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBTaGlueS5vdXRwdXRCaW5kaW5ncy5yZWdpc3RlcihzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYubmFtZSk7CiAgICB9CiAgfTsKCiAgdmFyIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgZnVuY3Rpb24gc2NoZWR1bGVTdGF0aWNSZW5kZXIoKSB7CiAgICBpZiAoIXNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCkgewogICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9LCAxKTsKICAgIH0KICB9CgogIC8vIFJlbmRlciBzdGF0aWMgd2lkZ2V0cyBhZnRlciB0aGUgZG9jdW1lbnQgZmluaXNoZXMgbG9hZGluZwogIC8vIFN0YXRpY2FsbHkgcmVuZGVyIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBvZiB0aGlzIHdpZGdldCdzIGNsYXNzCiAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJpbmRpbmdzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbihiaW5kaW5nKSB7CiAgICAgIHZhciBtYXRjaGVzID0gYmluZGluZy5maW5kKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgIGZvckVhY2gobWF0Y2hlcywgZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgc2l6ZU9iaiA9IGluaXRTaXppbmcoZWwsIGJpbmRpbmcpOwoKICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICJodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUgKyAiIGh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCI7CgogICAgICAgIHZhciBpbml0UmVzdWx0OwogICAgICAgIGlmIChiaW5kaW5nLmluaXRpYWxpemUpIHsKICAgICAgICAgIGluaXRSZXN1bHQgPSBiaW5kaW5nLmluaXRpYWxpemUoZWwsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICk7CiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgaW5pdFJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmluZGluZy5yZXNpemUpIHsKICAgICAgICAgIHZhciBsYXN0U2l6ZSA9IHsKICAgICAgICAgICAgdzogc2l6ZU9iaiA/IHNpemVPYmouZ2V0V2lkdGgoKSA6IGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgfTsKICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gMCAmJiBzaXplLmggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSBsYXN0U2l6ZS53ICYmIHNpemUuaCA9PT0gbGFzdFNpemUuaCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGxhc3RTaXplID0gc2l6ZTsKICAgICAgICAgICAgYmluZGluZy5yZXNpemUoZWwsIHNpemUudywgc2l6ZS5oLCBpbml0UmVzdWx0KTsKICAgICAgICAgIH07CgogICAgICAgICAgb24od2luZG93LCAicmVzaXplIiwgcmVzaXplSGFuZGxlcik7CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGNhc2VzIHdoZXJlIHdlJ3JlIHJ1bm5pbmcgaW4gYSBTaGlueQogICAgICAgICAgLy8gYXBwLCBidXQgdGhlIHdpZGdldCBpdHNlbGYgaXMgbm90IGEgU2hpbnkgb3V0cHV0LCBidXQKICAgICAgICAgIC8vIHJhdGhlciBhIHNpbXBsZSBzdGF0aWMgd2lkZ2V0LiBPbmUgZXhhbXBsZSBvZiB0aGlzIGlzCiAgICAgICAgICAvLyBhbiBybWFya2Rvd24gZG9jdW1lbnQgdGhhdCBoYXMgcnVudGltZTpzaGlueSBhbmQgd2lkZ2V0CiAgICAgICAgICAvLyB0aGF0IGlzbid0IGluIGEgcmVuZGVyIGZ1bmN0aW9uLiBTaGlueSBvbmx5IGtub3dzIHRvCiAgICAgICAgICAvLyBjYWxsIHJlc2l6ZSBoYW5kbGVycyBmb3IgU2hpbnkgb3V0cHV0cywgbm90IGZvciBzdGF0aWMKICAgICAgICAgIC8vIHdpZGdldHMsIHNvIHdlIGRvIGl0IG91cnNlbHZlcy4KICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJzaG93bi5odG1sd2lkZ2V0cyBzaG93bi5icy50YWIuaHRtbHdpZGdldHMgc2hvd24uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgImhpZGRlbi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMudGFiLmh0bWx3aWRnZXRzIGhpZGRlbi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciB0aGUgc3BlY2lmaWMgY2FzZSBvZiBpb3NsaWRlcywgd2hpY2gKICAgICAgICAgIC8vIGZsaXBzIHNsaWRlcyBiZXR3ZWVuIGRpc3BsYXk6bm9uZSBhbmQgZGlzcGxheTpibG9jay4KICAgICAgICAgIC8vIElkZWFsbHkgd2Ugd291bGQgbm90IGhhdmUgdG8gaGF2ZSBpb3NsaWRlLXNwZWNpZmljIGNvZGUKICAgICAgICAgIC8vIGhlcmUsIGJ1dCByYXRoZXIgaGF2ZSBpb3NsaWRlcyByYWlzZSBhIGdlbmVyaWMgZXZlbnQsCiAgICAgICAgICAvLyBidXQgdGhlIHJtYXJrZG93biBwYWNrYWdlIGp1c3Qgd2VudCB0byBDUkFOIHNvIHRoZQogICAgICAgICAgLy8gd2luZG93IHRvIGdldHRpbmcgdGhhdCBmaXhlZCBtYXkgYmUgbG9uZy4KICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICAvLyBJdCdzIE9LIHRvIGxpbWl0IHRoaXMgdG8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIKICAgICAgICAgICAgLy8gYnJvd3NlcnMgYmVjYXVzZSBpb3NsaWRlcyBpdHNlbGYgb25seSBzdXBwb3J0cwogICAgICAgICAgICAvLyBzdWNoIGJyb3dzZXJzLgogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlZW50ZXIiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWxlYXZlIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NyaXB0RGF0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtkYXRhLWZvcj0nIiArIGVsLmlkICsgIiddW3R5cGU9J2FwcGxpY2F0aW9uL2pzb24nXSIpOwogICAgICAgIGlmIChzY3JpcHREYXRhKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2Uoc2NyaXB0RGF0YS50ZXh0Q29udGVudCB8fCBzY3JpcHREYXRhLnRleHQpOwogICAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICAgIGlmICghKGRhdGEuZXZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIGRhdGEuZXZhbHMgPSBbZGF0YS5ldmFsc107CiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgZGF0YS5ldmFscyAmJiBrIDwgZGF0YS5ldmFscy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGJpbmRpbmcucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGluaXRSZXN1bHQsIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpOwogIH0KCgogIGZ1bmN0aW9uIGhhc19qUXVlcnkzKCkgewogICAgaWYgKCF3aW5kb3cualF1ZXJ5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciAkdmVyc2lvbiA9IHdpbmRvdy5qUXVlcnkuZm4uanF1ZXJ5OwogICAgdmFyICRtYWpvcl92ZXJzaW9uID0gcGFyc2VJbnQoJHZlcnNpb24uc3BsaXQoIi4iKVswXSk7CiAgICByZXR1cm4gJG1ham9yX3ZlcnNpb24gPj0gMzsKICB9CgogIC8qCiAgLyBTaGlueSAxLjQgYnVtcGVkIGpRdWVyeSBmcm9tIDEueCB0byAzLnggd2hpY2ggbWVhbnMgalF1ZXJ5J3MKICAvIG9uLXJlYWR5IGhhbmRsZXIgKGkuZS4sICQoZm4pKSBpcyBub3cgYXN5bmNyb25vdXMgKGkuZS4sIGl0IG5vdwogIC8gcmVhbGx5IG1lYW5zICQoc2V0VGltZW91dChmbikpLgogIC8gaHR0cHM6Ly9qcXVlcnkuY29tL3VwZ3JhZGUtZ3VpZGUvMy4wLyNicmVha2luZy1jaGFuZ2UtZG9jdW1lbnQtcmVhZHktaGFuZGxlcnMtYXJlLW5vdy1hc3luY2hyb25vdXMKICAvCiAgLyBTaW5jZSBTaGlueSB1c2VzICQoKSB0byBzY2hlZHVsZSBpbml0U2hpbnksIHNoaW55Pj0xLjQgY2FsbHMgaW5pdFNoaW55CiAgLyBvbmUgdGljayBsYXRlciB0aGFuIGl0IGRpZCBiZWZvcmUsIHdoaWNoIG1lYW5zIHN0YXRpY1JlbmRlcigpIGlzCiAgLyBjYWxsZWQgcmVuZGVyVmFsdWUoKSBlYXJsaWVyIHRoYW4gKGFkdmFuY2VkKSB3aWRnZXQgYXV0aG9ycyBtaWdodCBiZSBleHBlY3RpbmcuCiAgLyBodHRwczovL2dpdGh1Yi5jb20vcnN0dWRpby9zaGlueS9pc3N1ZXMvMjYzMAogIC8KICAvIEZvciBhIGNvbmNyZXRlIGV4YW1wbGUsIGxlYWZsZXQgaGFzIHNvbWUgbWV0aG9kcyAoZS5nLiwgdXBkYXRlQm91bmRzKQogIC8gd2hpY2ggcmVmZXJlbmNlIFNoaW55IG1ldGhvZHMgcmVnaXN0ZXJlZCBpbiBpbml0U2hpbnkgKGUuZy4sIHNldElucHV0VmFsdWUpLgogIC8gU2luY2UgbGVhZmxldCBpcyBwcml2eSB0byB0aGlzIGxpZmUtY3ljbGUsIGl0IGtub3dzIHRvIHVzZSBzZXRUaW1lb3V0KCkgdG8KICAvIGRlbGF5IGV4ZWN1dGlvbiBvZiB0aG9zZSBtZXRob2RzICh1bnRpbCBTaGlueSBtZXRob2RzIGFyZSByZWFkeSkKICAvIGh0dHBzOi8vZ2l0aHViLmNvbS9yc3R1ZGlvL2xlYWZsZXQvYmxvYi8xOGVjOTgxL2phdmFzY3JpcHQvc3JjL2luZGV4LmpzI0wyNjYtTDI2OAogIC8KICAvIElkZWFsbHkgd2lkZ2V0IGF1dGhvcnMgd291bGRuJ3QgbmVlZCB0byB1c2UgdGhpcyBzZXRUaW1lb3V0KCkgaGFjayB0aGF0CiAgLyBsZWFmbGV0IHVzZXMgdG8gY2FsbCBTaGlueSBtZXRob2RzIG9uIGEgc3RhdGljUmVuZGVyKCkuIEluIHRoZSBsb25nIHJ1biwKICAvIHRoZSBsb2dpYyBpbml0U2hpbnkgc2hvdWxkIGJlIGJyb2tlbiB1cCBzbyB0aGF0IG1ldGhvZCByZWdpc3RyYXRpb24gaGFwcGVucwogIC8gcmlnaHQgYXdheSwgYnV0IGJpbmRpbmcgaGFwcGVucyBsYXRlci4KICAqLwogIGZ1bmN0aW9uIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKSB7CiAgICBpZiAoc2hpbnlNb2RlICYmIGhhc19qUXVlcnkzKCkpIHsKICAgICAgd2luZG93LmpRdWVyeSh3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgIH0KICB9CgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBhcmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CiAgICAgIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKTsKICAgIH0sIGZhbHNlKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQoKCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEF0dGFjaG1lbnRVcmwgPSBmdW5jdGlvbihkZXBuYW1lLCBrZXkpIHsKICAgIC8vIElmIG5vIGtleSwgZGVmYXVsdCB0byB0aGUgZmlyc3QgaXRlbQogICAgaWYgKHR5cGVvZihrZXkpID09PSAidW5kZWZpbmVkIikKICAgICAga2V5ID0gMTsKCiAgICB2YXIgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlcG5hbWUgKyAiLSIgKyBrZXkgKyAiLWF0dGFjaG1lbnQiKTsKICAgIGlmICghbGluaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkF0dGFjaG1lbnQgIiArIGRlcG5hbWUgKyAiLyIgKyBrZXkgKyAiIG5vdCBmb3VuZCBpbiBkb2N1bWVudCIpOwogICAgfQogICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLmRhdGFmcmFtZVRvRDMgPSBmdW5jdGlvbihkZikgewogICAgdmFyIG5hbWVzID0gW107CiAgICB2YXIgbGVuZ3RoOwogICAgZm9yICh2YXIgbmFtZSBpbiBkZikgewogICAgICAgIGlmIChkZi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkKICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgICAgICBpZiAodHlwZW9mKGRmW25hbWVdKSAhPT0gIm9iamVjdCIgfHwgdHlwZW9mKGRmW25hbWVdLmxlbmd0aCkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGxlbmd0aCkgIT09ICJ1bmRlZmluZWQiICYmIGxlbmd0aCAhPT0gZGZbbmFtZV0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoID0gZGZbbmFtZV0ubGVuZ3RoOwogICAgfQogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBpdGVtOwogICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbGVuZ3RoOyByb3crKykgewogICAgICAgIGl0ZW0gPSB7fTsKICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuYW1lcy5sZW5ndGg7IGNvbCsrKSB7CiAgICAgICAgICAgIGl0ZW1bbmFtZXNbY29sXV0gPSBkZltuYW1lc1tjb2xdXVtyb3ddOwogICAgICAgIH0KICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMudHJhbnNwb3NlQXJyYXkyRCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiBhcnJheTsKICAgICAgdmFyIG5ld0FycmF5ID0gYXJyYXlbMF0ubWFwKGZ1bmN0aW9uKGNvbCwgaSkgewogICAgICAgICAgcmV0dXJuIGFycmF5Lm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93W2ldCiAgICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld0FycmF5OwogIH07CiAgLy8gU3BsaXQgdmFsdWUgYXQgc3BsaXRDaGFyLCBidXQgYWxsb3cgc3BsaXRDaGFyIHRvIGJlIGVzY2FwZWQKICAvLyB1c2luZyBlc2NhcGVDaGFyLiBBbnkgb3RoZXIgY2hhcmFjdGVycyBlc2NhcGVkIGJ5IGVzY2FwZUNoYXIKICAvLyB3aWxsIGJlIGluY2x1ZGVkIGFzIHVzdWFsIChpbmNsdWRpbmcgZXNjYXBlQ2hhciBpdHNlbGYpLgogIGZ1bmN0aW9uIHNwbGl0V2l0aEVzY2FwZSh2YWx1ZSwgc3BsaXRDaGFyLCBlc2NhcGVDaGFyKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgIHZhciBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB2YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmICghZXNjYXBlTW9kZSkgewogICAgICAgIGlmICh2YWx1ZVtwb3NdID09PSBzcGxpdENoYXIpIHsKICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlW3Bvc10gPT09IGVzY2FwZUNoYXIpIHsKICAgICAgICAgIGVzY2FwZU1vZGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50UmVzdWx0ICE9PSAiIikgewogICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CiAgLy8gRnVuY3Rpb24gYXV0aG9yZWQgYnkgWWlodWkvSkogQWxsYWlyZQogIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlciA9IGZ1bmN0aW9uKG8sIG1lbWJlcikgewogICAgdmFyIHBhcnRzID0gc3BsaXRXaXRoRXNjYXBlKG1lbWJlciwgJy4nLCAnXFwnKTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CiAgICAgIC8vIHBhcnQgbWF5IGJlIGEgY2hhcmFjdGVyIG9yICdudW1lcmljJyBtZW1iZXIgbmFtZQogICAgICBpZiAobyAhPT0gbnVsbCAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgcGFydCBpbiBvKSB7CiAgICAgICAgaWYgKGkgPT0gKGwgLSAxKSkgeyAvLyBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGluZSB0aGVuIGV2YWx1bGF0ZQogICAgICAgICAgaWYgKHR5cGVvZiBvW3BhcnRdID09PSAic3RyaW5nIikKICAgICAgICAgICAgb1twYXJ0XSA9IHRyeUV2YWwob1twYXJ0XSk7CiAgICAgICAgfSBlbHNlIHsgLy8gb3RoZXJ3aXNlIGNvbnRpbnVlIHRvIG5leHQgZW1iZWRkZWQgb2JqZWN0CiAgICAgICAgICBvID0gb1twYXJ0XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mIGFuCiAgLy8gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggYW4gZWxlbWVudCwgb3IgbnVsbCBpZiBub25lLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGVsKSB7CiAgICByZXR1cm4gZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpOwogIH07CgogIC8vIEZpbmRzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBzY29wZSB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLAogIC8vIGFuZCByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGVsZW1lbnQsIGlmIGFueS4gSWYgbm8gZWxlbWVudCBtYXRjaGVzIHRoZQogIC8vIHNlbGVjdG9yLCBvciB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCBoYXMgbm8gSFRNTFdpZGdldAogIC8vIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCwgdGhlbiBudWxsIGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIGVsID0gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKGVsKTsKICAgIH0KICB9OwoKICAvLyBGaW5kcyBhbGwgZWxlbWVudHMgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLCBhbmQKICAvLyByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlcyAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlcyBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoZSBlbGVtZW50cywgaW4gYW4gYXJyYXkuIElmIGVsZW1lbnRzIHRoYXQKICAvLyBtYXRjaCB0aGUgc2VsZWN0b3IgZG9uJ3QgaGF2ZSBhbiBhc3NvY2lhdGVkIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSwgdGhlIHJldHVybmVkIGFycmF5IHdpbGwgY29udGFpbiBudWxscy4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZEFsbCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBub2RlcyA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0cy5wdXNoKHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShub2Rlc1tpXSkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdmFyIHBvc3RSZW5kZXJIYW5kbGVycyA9IFtdOwogIGZ1bmN0aW9uIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpIHsKICAgIHdoaWxlIChwb3N0UmVuZGVySGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgIHZhciBoYW5kbGVyID0gcG9zdFJlbmRlckhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgaGFuZGxlcigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZWdpc3RlciB0aGUgZ2l2ZW4gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBhZnRlciB0aGUKICAvLyBuZXh0IHRpbWUgc3RhdGljIHdpZGdldHMgYXJlIHJlbmRlcmVkLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5hZGRQb3N0UmVuZGVySGFuZGxlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBwb3N0UmVuZGVySGFuZGxlcnMucHVzaChjYWxsYmFjayk7CiAgfTsKCiAgLy8gVGFrZXMgYSBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbiwgYW5kIHJldHVybnMgYW4KICAvLyBvbGQtc3R5bGUgY2xhc3MtYm91bmQgZGVmaW5pdGlvbi4gVGhpcyBzYXZlcyB1cyBmcm9tIGhhdmluZwogIC8vIHRvIHJld3JpdGUgYWxsIHRoZSBsb2dpYyBpbiB0aGlzIGZpbGUgdG8gYWNjb21vZGF0ZSBib3RoCiAgLy8gdHlwZXMgb2YgZGVmaW5pdGlvbnMuCiAgZnVuY3Rpb24gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmbikgewogICAgdmFyIHJlc3VsdCA9IHsKICAgICAgbmFtZTogZGVmbi5uYW1lLAogICAgICB0eXBlOiBkZWZuLnR5cGUsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuIGRlZm4uZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0sCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVuZGVyVmFsdWUoeCk7CiAgICAgIH0sCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoZGVmbi5maW5kKQogICAgICByZXN1bHQuZmluZCA9IGRlZm4uZmluZDsKICAgIGlmIChkZWZuLnJlbmRlckVycm9yKQogICAgICByZXN1bHQucmVuZGVyRXJyb3IgPSBkZWZuLnJlbmRlckVycm9yOwogICAgaWYgKGRlZm4uY2xlYXJFcnJvcikKICAgICAgcmVzdWx0LmNsZWFyRXJyb3IgPSBkZWZuLmNsZWFyRXJyb3I7CgogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pKCk7Cgo="></script>
<link href="data:text/css,%2Efaq%2Dpackage%7B%0Apadding%3A20px%3B%0A%7D%0A%2Efaqcollapsible%20%7B%0Abackground%2Dcolor%3A%20%23F0F0F0%3B%0Acolor%3A%20black%3B%0Acursor%3A%20pointer%3B%0Apadding%2Dtop%3A%2020px%3B%0Apadding%2Dbottom%3A%2020px%3B%0Awidth%3A%20100%25%3B%0Aborder%3A%200%3B%0Afont%2Dweight%3A%20bold%3B%0Atext%2Dalign%3A%20left%3B%0Aoutline%3A%20none%3B%0Afont%2Dsize%3A%2015px%3B%0Apadding%2Dleft%3A%2070px%3B%0A%7D%0A%2Efaq%2Dpackage%20%2Eactive%2C%20%2Efaqcollapsible%3Ahover%20%7B%0Abackground%2Dcolor%3A%20%23E8E8E8%3B%0A%7D%0A%2Efaqwrapper%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23FFF%3B%0A%7D%0A%2Efaqcollapsible%3Aafter%20%7B%0Acontent%3A%20%27%5C002B%27%3B%0Afont%2Dsize%3A%2028px%3B%0Acolor%3A%20black%3B%0Afont%2Dweight%3A%20bold%3B%0Aposition%3A%20relative%3B%0Afloat%3Aleft%3B%0Amargin%2Dleft%3A%20%2D40px%3B%0Amargin%2Dright%3A%205px%3B%0Amargin%2Dtop%3A%20%2D8px%3B%0A%7D%0A%2Efaq%2Dpackage%20%2Eactive%3Aafter%20%7B%0Acontent%3A%20%22%5C2212%22%3B%0A%7D%0A%2Efaqcontent%20%7B%0Apadding%2Dleft%3A%2080px%3B%0Apadding%2Dright%3A20px%3B%0Amax%2Dheight%3A%200%3B%0Aoverflow%3A%20hidden%3B%0Atransition%3A%20max%2Dheight%200%2E2s%20ease%2Dout%3B%0Abackground%2Dcolor%3A%20white%3B%0A%7D%0A%2Efaq%2Dexpand%2Dall%7B%0Apadding%3A%205px%3B%0Amargin%2Dbottom%3A%2010px%3B%0Aborder%3A%20none%3B%0Afont%2Dsize%3A%2015px%3B%0Abackground%2Dcolor%3A%23F0F0F0%3B%0A%7D%0A%2Efaq%2Dpackage%20%2Eactive%2C%20%2Efaq%2Dexpand%2Dall%3Ahover%20%7B%0Abackground%2Dcolor%3A%20%23E8E8E8%3B%0A%7D%0A" rel="stylesheet" />
<script src="data:application/javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ2ZhcScsCgogIHR5cGU6ICdvdXRwdXQnLAoKICBmYWN0b3J5OiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewoKICAgIHJldHVybiB7CgogICAgICByZW5kZXJWYWx1ZTogZnVuY3Rpb24oeCkgewoKICAgICAgICBmYXEoZWwsIHgpOwoKICAgICAgfSwKCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24od2lkdGgsIGhlaWdodCkge30KCiAgICB9OwogIH0KfSk7CgoKZnVuY3Rpb24gZmFxKGVsLCB4KXsKICB2YXIganNvbkRhdGEgPSB4LmRhdGEKCnZhciBmYXEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbC5pZCk7CmZhcS5jbGFzc0xpc3QuYWRkKCJmYXEtcGFja2FnZSIpOwoKdmFyIGZhcXRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiSDIiKTsKdmFyIHRpdGxldGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHguZmFxdGl0bGUpOwpmYXF0aXRsZS5hcHBlbmRDaGlsZCh0aXRsZXRleHQpOwpmYXEuYXBwZW5kQ2hpbGQoZmFxdGl0bGUpOwoKIGxldCBmYXFhbGxleHBhbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIGZhcWFsbGV4cGFuZC5jbGFzc0xpc3QuYWRkKCJmYXEtZXhwYW5kLWFsbCIpOwogICAgZmFxYWxsZXhwYW5kLmlubmVySFRNTCA9IHguZXhwYW5kX2FsbF9idXR0b25fdGV4dDsKCiAgICB2YXIgYWxsY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImZhcWNvbnRlbnQiKTsKICAgIHZhciBhbGxjb2xsYXBzaWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImZhcWNvbGxhcHNpYmxlIik7CiAgICBmYXFhbGxleHBhbmQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgaWYgKGZhcWFsbGV4cGFuZC5pbm5lckhUTUwgPT09IHguZXhwYW5kX2FsbF9idXR0b25fdGV4dCkgewogICAgICAgICAgICAgZmFxYWxsZXhwYW5kLmlubmVySFRNTCA9IHguY29sbGFwc2VfYWxsX2J1dHRvbl90ZXh0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgZmFxYWxsZXhwYW5kLmlubmVySFRNTCA9IHguZXhwYW5kX2FsbF9idXR0b25fdGV4dDsKICAgICAgICAgICAgfQogICAgZm9yIChpID0gMDsgaSA8IGFsbGNvbnRlbnQubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGZhcWFsbGV4cGFuZC5pbm5lckhUTUwgPT09IHguZXhwYW5kX2FsbF9idXR0b25fdGV4dCl7CiAgICAgICAgYWxsY29udGVudFtpXS5zdHlsZS5tYXhIZWlnaHQgPSBudWxsOwogICAgICAgIGFsbGNvbGxhcHNpYmxlW2ldLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIGFsbGNvbnRlbnRbaV0uc3R5bGUubWF4SGVpZ2h0ID0gYWxsY29udGVudFtpXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgIGFsbGNvbGxhcHNpYmxlW2ldLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICB9CiAgICB9CiAgfSk7CgpmYXEuYXBwZW5kQ2hpbGQoZmFxYWxsZXhwYW5kKTsKCmZvciAodmFyIGkgPSAwOyBpIDwganNvbkRhdGEuYW5zd2VyLmxlbmd0aDsgaSsrKSB7CgogICBsZXQgd3JhcHBlcmRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgd3JhcHBlcmRpdi5jbGFzc0xpc3QuYWRkKCJmYXF3cmFwcGVyIik7CiAgIGxldCBjb250ZW50ZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBjb250ZW50ZGl2LmNsYXNzTGlzdC5hZGQoImZhcWNvbnRlbnQiKTsKICAgbGV0IHB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7CiAgIHB0YWcuaW5uZXJIVE1MID0ganNvbkRhdGEuYW5zd2VyW2ldOwogICBjb250ZW50ZGl2LmFwcGVuZENoaWxkKHB0YWcpOwoKICAgIGxldCBxdWVzdGlvbmRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgcXVlc3Rpb25kaXYuY2xhc3NMaXN0LmFkZCgiZmFxY29sbGFwc2libGUiKTsKICAgIHF1ZXN0aW9uZGl2LmlubmVySFRNTCA9IGpzb25EYXRhLnF1ZXN0aW9uW2ldOwoKICAgIHF1ZXN0aW9uZGl2LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoImFjdGl2ZSIpOwogICAgdmFyIGZhcWNvbnRlbnQgPSB0aGlzLm5leHRFbGVtZW50U2libGluZzsKICAgIGlmIChmYXFjb250ZW50LnN0eWxlLm1heEhlaWdodCl7CiAgICAgIGZhcWNvbnRlbnQuc3R5bGUubWF4SGVpZ2h0ID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIGZhcWNvbnRlbnQuc3R5bGUubWF4SGVpZ2h0ID0gZmFxY29udGVudC5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgfQogIH0pOwogIGNvbnRlbnRkaXYuc3R5bGUuYmFja2dyb3VuZCA9IHguY29udGVudF9iYWNrZ3JvdW5kX2NvbG9yOwogIHdyYXBwZXJkaXYuYXBwZW5kQ2hpbGQocXVlc3Rpb25kaXYpOwogIHdyYXBwZXJkaXYuYXBwZW5kQ2hpbGQoY29udGVudGRpdik7CiAgZmFxLmFwcGVuZENoaWxkKHdyYXBwZXJkaXYpOwp9Cn0K"></script>

</head>
<body style="background-color: rgba(244,248,255,1.000000);">
<div id="htmlwidget_container">
<div id="faq" class="faq html-widget" style="width:80%;height:500px;">

</div>
</div>
<script type="application/json" data-for="faq">{"x":{"data":{"question":["How is GERD defined? ","Pathophysiologic alterations in GERD (6)?   ","Conditions presenting with symptoms similar to GERD?","What are the extra esophageal manifestations of GERD?   ","Gold standard for GERD diagnosis? ","How accurate is PPI trial in diagnosing GERD? ","Proportion of patients with reflux on barium esophagogram that end up having pH study proven GERD?  ","Is finding grade B esophagitis on endoscopy diagnostic for GERD?   what about grade D?  what about Barrett's esophagus on endoscopy?    ","What is the most common endoscopic finding in those with typical GERD symptoms? ","How long would you hold PPIs before EGD for suspected GERD? why? (2 reasons)    ","Can you diagnose GERD with HRM?","Role of HRM prior to antireflux surgery? (2)    ","How do you check for  peristaltic contractile reserve prior to antireflux surgery?     ","Strengths and weaknesses of wireless and catheter based pH testing?     ","How useful are dual pH sensor catheters?   <img src=\"https://www.nature.com/gimo/contents/pt1/images/gimo31-f1.jpg\">","What parameters are assessed via pH/ pH impedance tests?   which ones are the most consistently reliable?     ","What are the two symptom association parameters on pH studies? what are the cut offs? how valid?     ","When would you perform pH testing off PPI? hold for how long? ","When is pH testing on PPI recommended? ph or pH impedance?     <a href=\"https://images.journals.lww.com/ajg/Original.00000434-202201000-00014.F1.jpeg\"  > img <\/a>","Percentage of pregnant women with heart burn? ","How strong is the evidence behind diet and life style changes in GERD?     ","Which foods reduce the LES pressure? ","How does weight gain increase GERD?    ","Which antacid product potentially has the highest efficacy? ","Rate of esophagitis healing with PPIs? ","Is symptoms relief with PPIs more common with erosive esophagitis or NERD? Why?     ","Which PPIs have the highest potency (pH control)? is this often clinically meaningful?     ","Why do we recommend giving PPIs 30-60 minutes before meals?   which PPI can be given regardless of the mealtime?    ","Is there a benefit from switching from one PPI to another if incomplete response? why? ","Is there a role for genetic testing to assess PPI metabolism/response? ","Which patients benefit from maintenance PPI therapy?     ","% Of symptoms relapse after stopping PPIs?   in NERD and in EE ?     ","Which patients benefit the most from bedtime H2 blockers?   and is it better to use every night or prn?     ","What effect does metoclopramine have on esophagus?   is its used recommended in GERD?","Is Prucalopride potentially useful in GERD? ","What effect does Baclofen have on the esophagus? ","How effective is baclofen in treating reflux?     ","How strong is the evidence on using carafte in GERD?","What are the first line meds in treating GERD during pregnancy?   what categories are H2 blockers and PPIs?   ","% Of patients with BOTH GERD and laryngeal symptoms?     ","% Of patients with asthma plus GERD symptoms or abnormal pH study? ","Laryngoscopy findings in GERD? How accurate?    ","% Of patients with LPR and abnormal pH-impedance testing?    ","How useful is proximal acid reflux detection in predicting the outcomes of antireflux surgery in LPR?     ","Risk factors for abnormal esophageal acid exposure in patients with suspected extraesophageal reflux? (use to decide on/off PPI testing)","How strong is the evidence supporting use Pharyngeal and oropharyngeal reflux monitoring?     ","How useful is salivary pepcin in diagnosis of LPR?     ","Role of upfront treatment with PPIs in LPR (ie before pH testing)?     ","Which patients with LPR benefit from antireflux surgery?     ","% Of patients with refractory GERD? (after BID PPIs for 8-12 weeks)","Which GERD symptoms are less likely to respond to PPIs?","Mechanisms of refractory GERD?     ","% Of GERD patients improving with optimizing PPI dosing?     ","How long would you hold PPIs prior to a diagnostic EGD in GERD patients? ","% Of refractory GERD patients with EoE? ","When would you perform pH testing ON ppi?     ","For testing on ppi therapy, would you prefer ph only or ph impedance?","Percentage of refractory gerd patients who end up being diagnosed with achalasia?","Other motility disorders that can be identified by hrim in refractory gerd patients?","Gerd recurrence rate after laparoscopic antireflux surgery?","Pros and cons of partial vs complete fundoplication?","Rate of Acute complications with laparoscopic ARS? Rate of gerd recurrence?    ","How does magnetic sphincter augmentation work?    ","Most Frequent adverse event with MSA?    ","Risk of MSA erosion into the esophagus?","Can patients receive MSA if they develop gerd after bariatric surgery?","Efficacy of MAS vs ARS?    ","How does RYGP improve gerd?    ","What are the available endoscopic gerd therapies?","GERD Patients who are not candidates for endoscopic therapy?","How does Stretta work?","Would you offer Stretta [if available] to gerd patients?","Is TIF a partial or complete flap?","Efficacy of TIF?    ","Incidence of serious adverse events with TIF?","What are the minor ppi side effects?","Would you recommend monitoring b12, creat and bmd in patients on long term ppis?","What about Mag?"],"answer":["<p style=\"font-size: 28px;\"> <li> Reflux of gastric contents into the esophagus results in symptoms and/or complications. <br> <br> <li> GERD is objectively defined by the presence of characteristic mucosal injury seen at endoscopy and/or abnormal esophageal acid exposure demonstrated on a reflux monitoring study. &nbsp; &nbsp; <a href=\"https://hyp.is/c9dOOAz7Ee2lvPeAbgPWqQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Poorly functioning esophagogastric junction; the antireflux barrier composed of the LES and crural diaphragm, coupled with impaired esophageal clearance and alterations in esophageal mucosal integrity. <br> <br> <li> Reflux esophagitis develops when refluxed gastric juice triggers the release of cytokines and chemokines that attract inflammatory cells and that also might contribute to symptoms. <br> <br> <li> Other contributors to GERD symptoms may include decreased salivary production, delayed gastric emptying, and esophageal hypersensitivity &nbsp; &nbsp; <a href=\"https://hyp.is/foO0lAz_Ee2T_WNccKsDrA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   <a href=\"https://www.researchgate.net/publication/320084911/figure/fig1/AS:547961457344513@1507655600481/Pathophysiology-of-GERD-at-the-oesophagogastric-junction-and-oesophageal-body-The-left.png\">Image <\/a><\/p>","<p style=\"font-size: 28px;\"> <li> GERD are nonspecific and may overlap or be confused with those of other disorders such as rumination, achalasia, eosinophilic esophagitis (EoE), reflux hypersensitivity, functional disease, cardiac or pulmonary disease, and paraesophageal hernia. &nbsp; &nbsp; <a href=\"https://hyp.is/Lrh2tA0BEe2oHWOecb6LIA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Extraesophageal manifestations of GERD can include laryngeal and pulmonary symptoms such as hoarseness, throat clearing, and chronic cough and conditions such as laryngitis, pharyngitis, and pulmonary fibrosis. <br> <br> <li> It also has been proposed that GERD might exacerbate asthma. &nbsp; &nbsp; <a href=\"https://hyp.is/bfd0dA0BEe2mFgvDM-hupw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> Even in patients with established GERD, it can be difficult to establish that GERD is the cause of these extraesophageal problems.   <br>  Diagnoses of GERD by extraesophageal symptoms alone or by their response to PPIs are unreliable because of poor sensitivity and specificity for GERD and not recommended<\/p>","<p style=\"font-size: 28px;\"> <li> No gold standard for the diagnosis of GERD. <br> <br> <li> Thus, the diagnosis is based on a combination of symptom presentation, endoscopic evaluation of esophageal mucosa, reflux monitoring, and response to therapeutic intervention &nbsp; &nbsp; <a href=\"https://hyp.is/yoICAg0DEe2WJQslG-0KIg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Pooled sensitivity of 78% and specificity of only 54% (using endoscopy and pH monitoring as the reference standard) based on a meta-analysis and prospective study (7,8). &nbsp; &nbsp; <a href=\"https://hyp.is/_BMjyA0DEe2T2lMcoaMebQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li>  In a recent prospective study, only about one-half of patients with abnormal reflux on a barium study were found to have abnormal pH monitoring (12,13). <br> <br> <li> <br> <br> <li> The finding of barium reflux above the thoracic inlet with or without provocative maneuvers (including the water siphon test) somewhat increases the sensitivity for reflux, but not sufficiently for barium esophagram to be recommended as a diagnostic test for GERD (14). &nbsp; &nbsp; <a href=\"https://hyp.is/TTvFSA0EEe2igrepTx6wYw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Recent expert consensus statements concluded that LA grade A EE is not sufficient for a definitive diagnosis of GERD because it is not reliably differentiated from normal (16,17). <br> <br> <li> <br> <br> <li> LA grade B EE can be diagnostic of GERD in the presence of typical GERD symptoms and PPI response, whereas LA grade C is virtually always diagnostic of GERD. <br> <br> <li> In outpatients, LA grade D EE is a manifestation of severe GERD, but LA grade D EE might not be a reliable index of GERD severity in hospitalized patients &nbsp; &nbsp; <a href=\"https://hyp.is/lA9JDg0EEe2T2_Oa4y8xmQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  <a href=\"https://img.grepmed.com/uploads/13202/egd-losangeles-esophagitis-diagnosis-grading-original.jpeg\">img<\/a>   <br>  any Barrett's esophagus segment >3 cm with intestinal metaplasia on biopsy is diagnostic of GERD and obviates the need for pH testing merely to confirm that diagnosis. <\/p>","<p style=\"font-size: 28px;\"> <li> For patients having endoscopy for typical GERD symptoms, normal mucosa is the most common finding. <br> <br> <li> There are limited data on the frequency of finding EE in patients undergoing endoscopy while taking PPIs, but, because PPIs are highly effective for healing EE, underlying EE clearly can be missed in this setting. &nbsp; &nbsp; <a href=\"https://hyp.is/GMZpag0GEe27d-vi0FkSUg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> To maximize the yield of GERD diagnosis and assess for EE, diagnostic endoscopy should ideally be performed after PPIs have been stopped for 2 weeks and perhaps as long as 4 weeks if possible. &nbsp; &nbsp; <a href=\"https://hyp.is/YcYPng0GEe2qtR9cROSQLg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">discontinuation of PPI therapy led to return of EE in as little as 1 week (18).   <br>  Stopping PPIs for 24 weeks also will facilitate a diagnosis of EoE, which is a diagnostic consideration when endoscopy is performed for patients with symptoms that are believed to be due to GERD but are not eliminated by PPIs  <br>  Some patients will not be able to tolerate discontinuing their PPI therapy, but the diagnostic advantages discussed above warrant an attempt at stopping PPIs before performing diagnostic endoscopy for GERD (can use antacids). <\/p>","<p style=\"font-size: 28px;\"> <li> HRM is not alone a diagnostic test for GERD. <br> <br> <li> Weak lower esophageal sphincter (LES) pressure and ineffective esophageal motility often accompany severe GERD, but no manometric abnormality is specific for GERD &nbsp; &nbsp; <a href=\"https://hyp.is/E8yxog0HEe2kkS-6SzFytg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> HRM also has a role in the evaluation of patients considering surgical or endoscopic antireflux procedures, primarily to evaluate for achalasia. <br> <br> <li> Patients with achalasia can have heartburn and regurgitation that are mistaken for GERD symptoms, and antireflux procedures performed for such a mistaken diagnosis of GERD can result in devastating dysphagia &nbsp; &nbsp; <a href=\"https://hyp.is/PBQ2MA0HEe20BvNpTEAHYQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  - absent contractility is for most a contraindication to fundoplication   <br>  - \"tailor the antireflux operation: Nissen (complete) fundoplication reserved for patients with normal peristalsis and partial fundoplication used for those with ineffective esophageal motility, studies on this issue have not supported the efficacy. <br>  - HRM is part of the diagnostic work up for patients with reflux or non cardiac chest pain unresponsive to PPIs when an etiology for symptoms cannot be demonstrated by impedance-pH monitoring. <a href=\"https://d3i71xaburhd42.cloudfront.net/923b928ca1060fc4ac3eba21a80a1db212aa209d/3-Table2-1.png\">Image a>  <\/p>","<p style=\"font-size: 28px;\"> <li> In patients undergoing surgical treatment of GERD, reduced contractile reserve documented by multiple rapid swallows on HRM is associated with postoperative dysphagia &nbsp; &nbsp; <a href=\"https://hyp.is/W4uV8g0IEe2yNMOIHQzQvg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> <a href=\"https://onlinelibrary.wiley.com/cms/asset/0081dfd1-8cf3-4dd4-aa84-70a4d3f82442/nmo13584-fig-0001-m.jpg\">img<\/a><\/p>","<p style=\"font-size: 28px;\"> <li> With transnasally positioned pH and pH/impedance catheters, the monitoring period generally is limited to 24 hours, while wireless pH telemetry capsule monitoring can last from 48 to 96 hours. <br> <br> <li> In addition, the capsule avoids the physical discomfort and embarrassment of a transnasal catheter, and so, patients are more likely to carry on normal daily activities during capsule pH monitoring (21,22). <br> <br> <li> <br> <br> <li> There is no capsule system available for impedance monitoring, which requires a transnasal catheter &nbsp; &nbsp; <a href=\"https://hyp.is/cm5beg0REe20Ls8tkI8RKg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  - Impedance-pH testing also allows for measurement of weakly acidic and nonacid reflux, assessment of bolus clearance, and extent of proximal reflux.     <\/p>","<p style=\"font-size: 28px;\"> <li> Dual-pH sensor transnasal catheters and a hypopharyngeal pH probe are also available to document acid reflux into the proximal esophagus and oropharynx, but the utility of these techniques is highly questionable with studies reporting widely disparate results &nbsp; &nbsp; <a href=\"https://hyp.is/tzZxKg0REe2XOvscaD90bg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li>  Acid exposure time, number of reflux events, and symptom correlation. <br> <br> <li> Impedance-pH testing also allows for measurement of weakly acidic and nonacid reflux, assessment of bolus clearance, and extent of proximal reflux. <br> <br> <li> Reflux symptom association &nbsp; &nbsp; <a href=\"https://hyp.is/Vj7W4A0SEe2XPBcIFYdedQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> With both wireless capsule and catheter-based reflux tests, the most consistently reliable variables include the total acid exposure time and the composite DeMeester score.  <\/p>","<p style=\"font-size: 28px;\"> <li> The relationship between symptoms and reflux events can be assessed using the SI or SAP. <br> <br> <li> To calculate SI, the total number of reflux episodes associated with symptom episodes is divided by the total number of symptom episodes during the entire monitoring period; an SI  50% is considered positive. <br> <br> <li> To determine the SAP, the 24-hour monitoring period is divided into 720 two-minute increments, and each increment is evaluated for the occurrence of reflux and symptom episodes. <br> <br> <li> A Fisher exact test is performed to determine a P value for the probability that reflux and symptom events are randomly distributed, and the SAP is determined by subtracting the calculated P value from 1 and multiplying the remainder by 100%; an SAP > 95% is considered positive. &nbsp; &nbsp; <a href=\"https://hyp.is/eXFkyg0SEe2jwDc3HZRqpw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   - validity of both of these indices has been questioned  -  not as accurate in those with a normal endoscopy<\/p>","<p style=\"font-size: 28px;\"> <li> Generally recommended to monitor after PPIs are stopped for 7 days if the diagnosis of GERD is not clear and before antireflux surgery or endoscopic therapy for GERD to document abnormal acid reflux (17) &nbsp; &nbsp; <a href=\"https://hyp.is/78TDOA0SEe2UNbOoarfVYA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Reflux monitoring while on PPI therapy is suggested in patients who have had the diagnosis of GERD established by previous objective evidence (i.e., EE, Barrett's esophagus, and previous pH testing off PPI) but who have symptoms potentially reflux-related that have not responded to PPIs. <br> <br> <li> In these patients, impedance/pH testing is recommended to document reflux hypersensitivity for weakly acidic or nonacidic reflux and for acid reflux &nbsp; &nbsp; <a href=\"https://hyp.is/CSOYkA0TEe2m4Cd5awIWhQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Two-thirds of pregnant women experience heartburn, which can begin in any trimester (25). <br> <br> <li> <br> <br> <li> Most patients do not have a previous diagnosis of GERD &nbsp; &nbsp; <a href=\"https://hyp.is/AQ4CUg0ZEe2mFhPrkoZtww/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Common recommendations include weight loss for overweight patients, elevating the head of the bed, tobacco and alcohol cessation, avoidance of late night meals and bedtime snacks, staying upright during and after meals, and cessation of foods that potentially aggravate reflux symptoms such as coffee, chocolate, carbonated beverages, spicy foods, acidic foods such as citrus and tomatoes, and foods with high fat content (29). <br> <br> <li> <br> <br> <li> Supporting data for these recommendations are limited and variable, often involving only small and uncontrolled studies, and rarely as the only intervention, making interpretation and definitive recommendations difficult. &nbsp; &nbsp; <a href=\"https://hyp.is/eFRO1A0ZEe2k2zcLQywN8g/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   - several randomized controlled trials (RCTs), have demonstrated improvement in nocturnal GERD symptoms and nocturnal esophageal acid exposure with head of bed elevation or sleeping on a wedge. Also, compared with lying left-side down, lying right-side down increases nocturnal reflux and reflux after meals, presumably because right-sided recumbency places the EGJ in a dependent position relative to the pool of gastric contents that favors reflux.     -  who successfully quit smoking for a year had 44% improvement in GERD symptoms, compared with 18% in those who continued to smoke<\/p>","<p style=\"font-size: 28px;\"> <li>  Coffee, caffeine, citrus, and spicy food had little to no effect on LES pressure (36,37). <br> <br> <li> <br> <br> <li> However, some of these items might have irritant effects that could evoke GERD symptoms without influencing reflux. <br> <br> <li> Alcohol consumption, tobacco smoking, chocolate, peppermint, and high-fat foods do reduce LES pressure in the laboratory, but few studies document the benefits of avoiding these foods and practices. <br> <br> <li> Smoking cessation was shown to improve GERD symptoms in a large cohort study &nbsp; &nbsp; <a href=\"https://hyp.is/bET08g0bEe2j6eNgEQfzNg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li>  Obesity increases the risk of GERD, possibly because of a combination of eating a diet high in fat and other foods that promote reflux, increased intra-abdominal pressure that promotes reflux because of increased intra-abdominal fat, and physiologic changes induced by products of visceral fat  &nbsp; &nbsp; <a href=\"https://hyp.is/0mArsg0bEe20Ti9g024MGg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   -  A population-based study in Norway assessed weight and GERD symptoms at baseline and 10 years later and identified a dose-dependent improvement in GERD symptoms with weight loss (44). Prospective and cohort studies also have shown improvement in GERD with weight loss. One study documented a 40% reduction in frequent GERD symptoms in women who reduced their BMI by 3.5 or more compared with controls (45).<\/p>","<p style=\"font-size: 28px;\"> <li> Antacids are used exclusively for on-demand symptom relief with little evidence to favor 1 type over another. <br> <br> <li> Studies with an alginic acid preparation manufactured in the United Kingdom suggest potential efficacy in symptom relief compared with other products, but alginate content of preparations sold in other countries is variable (47). &nbsp; &nbsp; <a href=\"https://hyp.is/c96HfA9REe2WJ-MFwvsKsA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> PPIs showed a significantly faster healing rate (12%/week) vs H2RAs (6%/week), and faster, more complete heartburn relief (11.5%/week) vs H2RAs (6.4%/week) (48,49). &nbsp; &nbsp; <a href=\"https://hyp.is/kg6ayg9REe2UpRPq6sExMw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li>  PPIs are associated with a greater rate of complete symptom relief (usually assessed at 4 weeks) in patients with EE (70%80%) compared with patients with so-called NERD in which symptom relief approximates 50%60% (50). &nbsp; &nbsp; <a href=\"https://hyp.is/-Tt6fg9REe2tVs9E0CLirQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   likely many patients included in NERD who have functional heartburn and thus unlikely to respond to PPIs.<\/p>","<p style=\"font-size: 28px;\"> <li> If relative acid-suppression potencies of individual PPIs (based on their effects on mean 24-hour intragastric pH) are standardized to omeprazole to yield omeprazole equivalents (OEs, with omeprazole having an OE of 1.00), the relative potencies of standard-dose pantoprazole, lansoprazole, omeprazole, esomeprazole, and rabeprazole have been estimated at 0.23, 0.90, 1.00, 1.60, and 1.82 OEs, respectively (52,53). <br> <br> <li> <br> <br> <li>        &nbsp; &nbsp; <a href=\"https://hyp.is/e3_bBg9SEe2N0NcWe9LGqQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> <a href=\"https://img.grepmed.com/uploads/11398/pharmacology-ppi-conversion-potency-reflux-original.jpeg\">img<\/a><\/p><\/p>","<p style=\"font-size: 28px;\"> <li> PPIs can bind only to proton pumps that are actively secreting acid. <br> <br> <li> Because meals stimulate proton pump activity, enteric-coated PPIs control intragastric pH best when given before a meal (3060 minutes before breakfast for once-daily dosing and 3060 minutes before breakfast and dinner for twice-daily dosing (54,55)). &nbsp; &nbsp; <a href=\"https://hyp.is/GNrURg9TEe2EK5efb4Kddw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   - Bedtime dosing is discouraged because this is less effective than a predinner dose in acid control (56).    - Dexlansoprazole, a dual delayed release PPI, in which first absorption is in the duodenum, then partially further down the small bowel, seems to have similar efficacy in pH control regardless of meal timing.     - An omeprazole-sodium bicarbonate combination that is not enteric-coated provides good control of intragastric pH in the first 4 hours of sleep when dosed at bedtime (57). <\/p>","<p style=\"font-size: 28px;\"> <li> There seems to be a wide variation in individual intragastric pH control between PPIs, a rationale for considering switching PPIs in patients with incomplete response (58). &nbsp; &nbsp; <a href=\"https://hyp.is/V5b-Mg9WEe2_7I-ow7Ss4g/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Studies suggest that genetic differences in CYP2C19 metabolism affect PPI response; however, genetic testing in this regard has no established role in practice. <br> <br> <li> If one is considering a PPI switch, changing to a PPI that does not rely on CYP2C19 for primary metabolism (rabeprazole) might be considered. &nbsp; &nbsp; <a href=\"https://hyp.is/eOhNeg9WEe2Rv0frWhzEgA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Maintenance PPI therapy should be administered for patients with GERD complications including severe EE (LA grade C or D) and Barrett's esophagus (60). <br> <br> <li> <br> <br> <li> For patients without EE or Barrett's esophagus who continue to have symptoms when PPI therapy is discontinued, consideration can be given to on-demand therapy in which PPIs are taken only when symptoms occur and discontinued when they are relieved (61,62). &nbsp; &nbsp; <a href=\"https://hyp.is/0m6FbA9WEe2XTKOliVIDMQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  Step-down therapy to H2RAs is another acceptable option for management, particularly in patients with NERD (65,66)    - Use of the lowest effective PPI dose is recommended and logical   - abrupt PPI discontinuation and potential rebound acid hypersecretion<\/p>","<p style=\"font-size: 28px;\"> <li> Two-thirds of patients with nonerosive disease responsive to PPIs will demonstrate symptomatic relapse when PPIs are stopped. <br> <br> <li> With LA grade C esophagitis, nearly 100% will relapse within 6 months (63). <br> <br> <li> <br> <br> <li> Recurrence of EE after discontinuation can occur in as little as 12 weeks, particularly in patients with previous LA grade C EE (18). &nbsp; &nbsp; <a href=\"https://hyp.is/AfaZWhEyEe2Q7_-gnV_JNw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Based on these data, use of a bedtime H2RA may be beneficial if dosed on an as-needed basis for patients with nocturnal symptoms and for patients with objective evidence of nocturnal acid reflux on pH monitoring despite PPI treatment. &nbsp; &nbsp; <a href=\"https://hyp.is/ZI_nVhEyEe2OQ4dlX1-8Yw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  - although a well-performed study demonstrated loss of pH control (tachyphylaxis) after a month of bedtime H2RA therapy (71).<\/p>","<p style=\"font-size: 28px;\"> <li> Metoclopramide has been shown to increase LES pressure, enhance esophageal peristalsis, and augment gastric emptying. <br> <br> <li> However, data on its efficacy in GERD are scant, and significant adverse events have been reported with long-term and high-dose metoclopramide use, including central nervous system side effects such as drowsiness, agitation, irritability, depression, dystonic reactions, and tardive dyskinesia (72,73). &nbsp; &nbsp; <a href=\"https://hyp.is/vFBiwhEyEe2czYNAzkxCGg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Prucalopride, a 5 HT agonist US Food and Drug Administration (FDA)-approved for treatment of constipation, was shown in 1 off-label use study to improve gastric emptying and reduce esophageal acid exposure in patients with GERD. <br> <br> <li> In the future, this may be a potential add-on therapy for patients with GERD on PPIs found to have delayed gastric emptying (74) &nbsp; &nbsp; <a href=\"https://hyp.is/iB474BEzEe2U32MiwQ5WpQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Baclofen, a GABAB agonist, reduces the transient LES relaxations that enable reflux episodes. <br> <br> <li> Baclofen decreases the number of postprandial acid and nonacid reflux events, nocturnal reflux activity, and belching episodes (7577). &nbsp; &nbsp; <a href=\"https://hyp.is/8h312hEzEe2p7TMzuiK5zg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> 520 mg 3 times a day can be considered in patients with objective documentation of continued symptomatic reflux despite optimal PPI therapy. &nbsp; &nbsp; <a href=\"https://hyp.is/FJzCshE0Ee2L-1N5h1fD-w/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">  - Short-term RCTs have demonstrated symptomatic improvement with baclofen (7577).   - A randomized, placebo-controlled trial of medical therapy (including baclofen) vs antireflux surgery for PPI-refractory heartburn found no significant benefit for baclofen compared with placebo at 1 year, but the study was not sufficiently powered to detect a small but potentially important effect for baclofen (24). Usage is limited by side effects of dizziness, somnolence, and constipation.<\/p>","<p style=\"font-size: 28px;\"> <li> Limited studies have suggested similar efficacy to H2RAs, but there are no comparative data to PPIs nor any combination studies with these agents. <br> <br> <li> Sucralfate is largely unabsorbed and has no systemic toxicity. &nbsp; &nbsp; <a href=\"https://hyp.is/mFmpThE0Ee2Z5T_qpcrBpw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li>  When lifestyle modifications fail, antacids (aluminum-, calcium-, or magnesium-containing), alginates, and sucralfate are the first-line therapeutic agents. <br> <br> <li> All histamine H2-blockers are FDA category B, and all PPIs are FDA category B except omeprazole, which is FDA category C. &nbsp; &nbsp; <a href=\"https://hyp.is/8QflXhE2Ee2Z7JNJB1UUbA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> In a US survey study, 26% of patients reported both GERD and laryngeal symptoms (80). &nbsp; &nbsp; <a href=\"https://hyp.is/40nJeBE7Ee2p028MwzWzJg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> 38% reported voice disorders and 44% had occasional breathing difficulties  <br>   In a case-control study of veterans, patients with esophagitis or esophageal strictures were more likely to have a diagnosis of laryngitis (odds ratio [OR] 2.01), aphonia (OR 1.81), asthma (OR 1.51), and pharyngitis (OR 1.48) compared with control<\/p>","<p style=\"font-size: 28px;\"> <li>  1 systematic review of 28 studies identifying GERD symptoms in 59% of patients with asthma and abnormal pH testing in 51% (83). &nbsp; &nbsp; <a href=\"https://hyp.is/FYsqhBE9Ee2htTcStJarJg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Findings on laryngoscopy that are associated with reflux include posterior commissure hypertrophy, laryngeal and arytenoid inflammation, vocal cord edema, and endolaryngeal mucus. &nbsp; &nbsp; <a href=\"https://hyp.is/4kmQMhE-Ee2H2f8KeoL1AQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> The use of laryngoscopy for diagnosis of LPR has substantial limitations, with inflammation seen in asymptomatic volunteers, low reproducibility, and lack of correlation between laryngoscopic findings and symptoms. Although ENT physicians often treat LPR based on laryngoscopy findings, a poor response to medical therapy should not be surprising.<\/p>","<p style=\"font-size: 28px;\"> <li>  PH-impedance testing in patients with LPR symptoms is abnormal in 40% of cases (96). &nbsp; &nbsp; <a href=\"https://hyp.is/OCaNDh13Ee2Uhs-MIlBgjQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> chronic cough can be associated with weakly acidic and nonacidic reflux events  <br>  proximal reflux was noted to be more common in the patients with globus (101).<\/p>","<p style=\"font-size: 28px;\"> <li> In the absence of a clear definition of normal proximal esophageal reflux, interpretation of impedance results for extraesophageal GERD is problematic, and surgical outcomes seem to be predicted better by traditional reflux parameters. &nbsp; &nbsp; <a href=\"https://hyp.is/aTCu1h2OEe21Gpv8X5JDsA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> One study found that extraesophageal symptoms were not more frequently associated with proximal esophageal reflux than typical GERD symptoms and that, irrespective of symptoms, half of all reflux events extended to the proximal esophagus (103).<\/p>","<p style=\"font-size: 28px;\"> <li>  In patients with extraesophageal symptoms persistent after 2 months of b.i.d. <br> <br> <li> PPIs, the investigators suggest calculation of the Heartburn, Asthma, and BMI Extraesophageal Reflux score1 point each for BMI > 25, asthma, and heartburn, but no points for cough or hoarseness. <br> <br> <li> pH-impedance testing on PPIs was recommended for patients with a Heartburn, Asthma, and BMI Extraesophageal Reflux score of 3, whereas testing off PPIs was recommended for those with scores 2. &nbsp; &nbsp; <a href=\"https://hyp.is/j5_9aB2fEe2uP2OmhtpZyw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Early studies of oropharyngeal pH testing were promising and seemed to predict success of antireflux surgery (120,121). <br> <br> <li> <br> <br> <li> However, subsequent studies have failed to identify a significant correlation between oropharyngeal reflux events and pH-impedance reflux events, suggesting that decreases in oropharyngeal pH may be due to factors other than gastroesophageal reflux (122126). &nbsp; &nbsp; <a href=\"https://hyp.is/q8wL8h8SEe2Z6EMnzfUNHw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> no significant differences in oropharyngeal acid exposure between PPI responders, partial responders, and nonresponders.   <br>  <br>  There were no significant differences in oropharyngeal acid exposure between PPI responders, partial responders, and nonresponders. <br> Lack of correlation between oropharyngeal pH events and pH-impedance events was seen in another study (ie. the low pH may not be due to acid refluxing from esophagus)  <\/p>","<p style=\"font-size: 28px;\"> <li> A recent meta-analysis of 11 observational studies examined the role of salivary pepsin testing in diagnosing LPR (129). <br> <br> <li> <br> <br> <li> Significant heterogeneity was found, with varying reference standards for LPR diagnosis (pH monitoring, symptoms, and laryngoscopic signs), different pepsin assays, variable definitions of abnormal tests, and number of pepsin tests performed. <br> <br> <li> Another study found pooled sensitivity of pepsin testing for LPR was 64% and specificity was 68%, with an area under the curve of 0.71 (130). &nbsp; &nbsp; <a href=\"https://hyp.is/KwBQth8VEe2p6SMVWpUMGw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> <img src=\"https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs12876-017-0667-9/MediaObjects/12876_2017_667_Fig3_HTML.gif\"><\/p>","<p style=\"font-size: 28px;\"> <li> Although PPI treatment is often the first step in the management of LPR, this approach may need to be reconsidered. <br> <br> <li> One study comparing up-front reflux testing for LPR patients rather than starting them on empiric PPI therapy found that overall evaluation and treatment costs were lower with initial pH-impedance and esophageal manometry testing (142). <br> <br> <li> <br> <br> <li> Also, a comparison of several algorithms for managing LPR revealed that total costs of therapy were lower in LPR patients treated with initial twice-daily PPI dosing rather than once-daily PPI dosing (142). &nbsp; &nbsp; <a href=\"https://hyp.is/_oQCbiR2Ee2b9uuZ4wYOjg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> questionable role in treating asthma or chronic cough makes diagnostic role less helpful.     <hr>  can be considered if patient is presenting with typical GERD symptoms (in addition to the suspected LPR)      <a href=\"https://images.journals.lww.com/ajg/Original.00000434-202201000-00014.F2.jpeg\" >algorithm<\/a>     <\/p>","<p style=\"font-size: 28px;\"> <li> Predicting which patients with extraesophageal symptoms will improve with antireflux surgery is challenging. <br> <br> <li> In 1 study of patients with extraesophageal symptoms, predictors of symptomatic improvement after surgery included the presence of heartburn with or without regurgitation and abnormal acid exposure time on pH testing (104). &nbsp; &nbsp; <a href=\"https://hyp.is/Jatz9iR_Ee2EzMsnDZjFXQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   outcomes are inferior to those of antireflux surgery for patients with traditional GERD symptoms  <br>  Recurrence of symptoms after surgery was more likely in patients with extraesophageal symptoms and in those who had a poor response to preoperative PPI therapy (154).     <br>  <br>  Patients with extraesophageal symptoms that do not respond to PPIs and patients without objective evidence of reflux should avoid surgical or endoscopic treatment of GERD.<\/p>","<p style=\"font-size: 28px;\"> <li> It has been suggested that up to 40% of patients treated with PPIs will report persistent symptoms of heartburn and regurgitation, with negative effects on quality of life &nbsp; &nbsp; <a href=\"https://hyp.is/vecyQiSCEe24cLeLFyb8XA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Heartburn is more likely to respond to PPIs than regurgitation or extraesophageal symptoms. <br> <br> <li> As such, it is clinically useful to separate refractory heartburn, regurgitation, and extraesophageal symptoms when thinking about these patients. &nbsp; &nbsp; <a href=\"https://hyp.is/9MrbiCSCEe2QasPgn0bUxQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Potential mechanisms underlying symptoms suspected due to GERD but refractory to PPI therapy &nbsp; &nbsp; <a href=\"https://hyp.is/3Uy67CSEEe2mZueXFXhxzQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\">   <a href=\"https://images.journals.lww.com/ajg/Original.00000434-202201000-00014.T4.jpeg\">img<\/a>   <\/p>","<p style=\"font-size: 28px;\"> <li> 42 of 366 (11.4%) participants had 50% improvement in GERD symptoms when omeprazole use was optimized, with dosing 30 minutes before breakfast and dinner (24). <br> <br> <li> <br> <br> <li> Another study of patients with NERD with typical GERD symptoms despite PPI use found that 35% responded to daily esomeprazole when dosed correctly (164). &nbsp; &nbsp; <a href=\"https://hyp.is/5n5MyiVCEe2pUdPRgpjevw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> 11-35%<\/p>","<p style=\"font-size: 28px;\"> <li> A recent study found that EE can relapse within 2 weeks after stopping PPIs, with some patients even developing LA grade C EE (63) &nbsp; &nbsp; <a href=\"https://hyp.is/wGaXAiVEEe2855eEGFUovw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> EoE has been seen in 1%8% of patients with refractory GERD (24,167170). &nbsp; &nbsp; <a href=\"https://hyp.is/p2t0UiVEEe2O6rcow3tbcA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> On-therapy monitoring is suggested before surgery or endoscopic intervention in patients with previous objective findings of GERD (such as Barrett's esophagus or LA grade C/D EE) who have continued symptoms despite PPI treatment (17). &nbsp; &nbsp; <a href=\"https://hyp.is/8ogdBiVNEe2NdlMMUdPanQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> the documentation of persistent abnormal acid reflux on PPIs or of a positive association between symptoms and reflux episodes offers reassurance that surgery or endoscopic therapy can be successful in the PPI-refractory patient<\/p>","<p style=\"font-size: 28px;\"> <li> Impedance-pH monitoring rather than pH monitoring alone is recommended for on-therapy reflux monitoring, both because the yield of pH monitoring in this setting is so low (fewer than 10% of patients on twice-daily PPIs have persistently abnormal acid reflux (160)) and because impedance monitoring enables correlation between symptoms and nonacid reflux episodes. &nbsp; &nbsp; <a href=\"https://hyp.is/Zylw2CdREe2OhUuo7OaU0A/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Patients with refractory GERD, 1%3% of patients are found to have achalasia when manometry is performed  &nbsp; &nbsp; <a href=\"https://hyp.is/uzizoCdREe2s9Kc50sfMqA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Esophageal aperistalsis are identified in roughly 3% of manometry tests performed for evaluation of GERD (177). <br> <br> <li> <br> <br> <li> These patients often report heartburn symptoms and have a poor response to antireflux surgery. <br> <br> <li> Other disorders, such as rumination and supragastric belching, may also detected by esophageal manometry. &nbsp; &nbsp; <a href=\"https://hyp.is/4XGGbidREe2Uw-N-CiBTQA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Wide range of GERD recurrence rates. <br> <br> <li> Cohort studies often found high rates of postoperative antireflux medication usage (up to 43%) (192196), whereas several randomized trials of LARS vs medical therapy conducted at specialized centers described lower GERD recurrence rates (10%27% during follow-up periods of 35 years) (197199) &nbsp; &nbsp; <a href=\"https://hyp.is/SBR2ZCdTEe2vptOC0L2MOg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Compared with Nissen (complete) fundoplication, partial fundoplications (e.g., Toupet and Dor) seem to have similar efficacy in relieving GERD symptoms, but result in less postoperative dysphagia, gas-bloat, and inability to belch and vomit (202205). <br> <br> <li> <br> <br> <li> However, partial fundoplication also might have a higher rate of recurrent GERD (205). <br> <br> <li> <br> <br> <li>        &nbsp; &nbsp; <a href=\"https://hyp.is/l-1WBidTEe2N89O4AIqLBA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> The major question for patients considering antireflux surgery is this: Does the >80% possibility of long-term freedom from PPIs and their attendant risks warrant the 4% risk of acute complications of fundoplication and its 17.7% risk of GERD recurrence? (207). &nbsp; &nbsp; <a href=\"https://hyp.is/aAJkvCdUEe2zjnOh8dn6Fg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> good numbers to use for counseling <\/p>","<p style=\"font-size: 28px;\"> <li> Magnetic sphincter augmentation\n      MSA with the LINX Reflux Management System, a necklace of titanium beads with magnetic cores that encircles the distal esophagus to bolster the LES and prevent reflux, was developed as a less invasive and more readily reversible GERD treatment than fundoplication. &nbsp; &nbsp; <a href=\"https://hyp.is/8ojWhCdUEe22Id8S8tzSnQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> patients cannot have magnetic resonance imaging with scanning systems >1.5 T<\/p>","<p style=\"font-size: 28px;\"> <li> Dysphagia was the most frequent adverse event, experienced by 68% of patients in the postoperative period, by 11% at 1 year, and by 4% at 3 years. <br> <br> <li> Six patients had serious adverse events, and 6 eventually had the device removed. <br> <br> <li> In a 5-year follow-up of patients in this study, there were no device erosions or migrations, 85% of patients had discontinued their use of PPIs, and all patients reported the ability to belch and vomit (209). &nbsp; &nbsp; <a href=\"https://hyp.is/5NeaFidUEe2U3ZdXdZ5u0w/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> data from an early pilot study, 100 patients <\/p>","<p style=\"font-size: 28px;\"> <li> Risk of erosion was 0.3% at 4 years (213). <br> <br> <li> <br> <br> <li> The median time to erosion was 26 months, and most occurred between 1 and 4 years after device implantation. <br> <br> <li> Most of the eroded devices were removed by a combination of endoscopy and laparoscopy, and there were no serious complications &nbsp; &nbsp; <a href=\"https://hyp.is/naLHgidVEe2QH_dlSkpEMQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> MSA also seems to have a role in the treatment of GERD that worsens or develops after bariatric operations such as sleeve gastrectomy and RYGB (218). &nbsp; &nbsp; <a href=\"https://hyp.is/7MIbdCdVEe2QIrvi3alomQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Clinical outcomes of the 2 procedures are similar, and both have unique advantages and disadvantages. <br> <br> <li> The minimal surgical dissection required for MSA results in greater technical ease, shorter operative times, and shorter durations of hospital stays than for fundoplication. <br> <br> <li> MSA is also easier to reverse, and MSA may result in less gas-bloat and greater ability to belch and vomit than fundoplication. <br> <br> <li> The magnetic resonance imaging restriction after MSA is a disadvantage, and compared with fundoplication, there is a paucity of long-term data on MSA outcomes. <br> <br> <li>  &nbsp; &nbsp; <a href=\"https://hyp.is/LboCkCdWEe29vT_w1Ll8SQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> no randomized trials comparing the 2 procedures, it is difficult to recommend one over the other at this time.<\/p>","<p style=\"font-size: 28px;\"> <li> RYGB can control GERD in obese patients, presumably because the small gastric pouch fashioned during RYGB produces far less acid than an intact stomach, and because the accompanying long alimentary loop prevents the reflux of bile. &nbsp; &nbsp; <a href=\"https://hyp.is/Z2fhzidWEe2b9j939klI6g/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> In addition, a recent, nationwide cohort study of all adults with preoperative reflux who underwent gastric bypass in Sweden between 2006 and 2015 found that, in 2,454 participants followed for median 4.6 years, reflux recurred in 48.8% (95% CI, 46.851.0) within 2 years of the operation (226). The authors concluded that the efficacy of gastric bypass for GERD symptoms might have been overestimated. Finally, reports have documented the occasional new development of GERD after RYGB (218).<\/p>","<p style=\"font-size: 28px;\"> <li> Only endoscopic GERD treatments still widely available are radiofrequency antireflux treatment (Stretta; Restech, Houston, TX) and TIF (endogastric solutions) &nbsp; &nbsp; <a href=\"https://hyp.is/XKYDyCdXEe2_bR-dsPo5_w/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Studies of the endoscopic procedures generally have excluded patients with hiatal hernias >2 cm, grade C and D EE, esophageal strictures, and long-segment Barrett's &nbsp; &nbsp; <a href=\"https://hyp.is/fpXwOCdXEe2OD69DbDTDGA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Initially, it was believed to control reflux by inducing swelling and mechanical alteration at the esophagogastric junction. <br> <br> <li> However, an early, sham-controlled trial found that, 6 months after treatment, Stretta had significantly improved GERD symptoms and quality of life, but it did not decrease esophageal acid exposure (227). <br> <br> <li> <br> <br> <li> This raised the possibility that the procedure might alleviate GERD symptoms by altering sensation in the distal esophagus &nbsp; &nbsp; <a href=\"https://hyp.is/zGUMGCdXEe2t-X8zOECRww/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Contradictory conclusions regarding Stretta's efficacy. <br> <br> <li> One meta-analysis that evaluated only RCTs found that Stretta did not produce significant changes in esophageal acid exposure, quality of life, or the ability to stop PPIs (228), whereas another meta-analysis that included both controlled and cohort studies concluded that Stretta significantly reduced esophageal acid exposure, improved quality of life, and decreased PPI usage (229). <br> <br> <li> <br> <br> <li> Nevertheless, in 2013, the Society of American Gastrointestinal and Endoscopic Surgeons gave Stretta a strong recommendation for use in patients who refuse laparoscopic Nissen fundoplication (230). &nbsp; &nbsp; <a href=\"https://hyp.is/_2_DtCdXEe2tLcvwnj3nwg/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> TIF attempts to create a flap valve involving 180 to 270 &nbsp; &nbsp; <a href=\"https://hyp.is/NGnt9idYEe2MpPsfaS_HwA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Long-term benefit of TIF is not established and questionable (217). <br> <br> <li> <br> <br> <li> One recent systematic review and meta-analysis on the use of TIF for refractory GERD found that TIF resulted in significant improvements in GERD health-related quality of life and DeMeester scores, enabling 89% of patients to discontinue PPIs (232). <br> <br> <li> <br> <br> <li> However, another systematic review and meta-analysis on the use of TIF for the treatment of GERD found that although symptoms responded to TIF significantly more often that to PPIs/sham, TIF did not result in significant improvement in esophageal acid exposure and most patients resumed PPIs at reduced dosages during long-term follow-up. &nbsp; &nbsp; <a href=\"https://hyp.is/c6GO1CdYEe2tMfMzS1m25Q/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"> rate of total satisfaction with TIF was 69% by 6 months<\/p>","<p style=\"font-size: 28px;\"> <li> Serious adverse events (perforation and bleeding) was 2.4 &nbsp; &nbsp; <a href=\"https://hyp.is/prHGzCdYEe2q-lvpRxmMhQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Switching PPIs can be considered for patients who experience minor PPI side effects including headache, abdominal pain, nausea, vomiting, diarrhea, constipation, and flatulence. &nbsp; &nbsp; <a href=\"https://hyp.is/3F-ILCdYEe2_d28ti9C-QA/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> 3. <br> <br> <li> For patients with GERD on PPIs who have no other risk factors for bone disease, we do not recommend that they raise their intake of calcium or vitamin D or that they have routine monitoring of bone mineral density. <br> <br> <li>             4. <br> <br> <li> For patients with GERD on PPIs who have no other risk factors for vitamin B12 deficiency, we do not recommend that they raise their intake of vitamin B12 or that they have routine monitoring of serum B12 levels. <br> <br> <li>             5. <br> <br> <li> For patients with GERD on PPIs who have no other risk factors for kidney disease, we do not recommend that they have routine monitoring of serum creatinine levels. &nbsp; &nbsp; <a href=\"https://hyp.is/_eIvzCdYEe2Mq5taCKtlcQ/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>","<p style=\"font-size: 28px;\"> <li> Two meta-analyses on this issue concluded that long-term PPI use is significantly associated with hypomagnesemia (310,314), whereas another 2 concluded that the risk of PPI-induced hypomagnesemia was unclear because of significant heterogeneity among studies (311,312). <br> <br> <li> <br> <br> <li> A recent AGA Best Practice Recommendation concluded that long-term PPI users should not routinely screen or monitor serum magnesium levels (315), whereas the FDA suggests that health care providers should consider monitoring magnesium levels before initiation of PPI treatment and then periodically (http://www.fda.gov/Drugs/DrugSafety/ucm245011.htm). <br> <br> <li> <br> <br> <li> We feel that presently there are insufficient data to make a meaningful recommendation  &nbsp; &nbsp; <a href=\"https://hyp.is/NPpPgCdZEe2QQL9syQfyNw/journals.lww.com/ajg/fulltext/2022/01000/acg_clinical_guideline_for_the_diagnosis_and.14.aspx\" target=\"_blank\">***<\/a><\/p>\n<p>&nbsp;<\/p>\n<p style=\"padding-left: 40px; font-size: 24px; font-style: italic;\"><\/p>"]},"faqtitle":"QA","expand_all_button_text":"+ Expand All","collapse_all_button_text":"- Collapse All","content_background_color":"white"},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="faq">{"viewer":{"width":"80%","height":350,"padding":15,"fill":false},"browser":{"width":"80%","height":500,"padding":40,"fill":false}}</script>
</body>
</html>
